<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💕 Happy Birthday My Sminky Girlfriend 💕</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #ffc2d1;
            font-family: 'Times New Roman', serif;
            color: white;
            overflow-x: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            text-align: center;
            padding: 20px;
            max-width: 90vw;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            font-family: 'Times New Roman', serif;
        }

        .start-btn {
            font-size: 24px;
            font-family: 'Times New Roman', serif;
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff6b6b, #ff9ff3);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            margin: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .art-container {
            display: none;
            white-space: pre-wrap;
            font-size: 8px;
            line-height: 1.1;
            text-align: left;
            overflow-x: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            margin: 20px 0;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .art-container {
                font-size: 4px;
                padding: 5px;
            }
        }

        @media (min-width: 769px) {
            .art-container {
                font-size: 10px;
            }
        }

        .hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .heart {
            position: absolute;
            color: #ff6b6b;
            font-size: 20px;
            animation: fall 8s linear infinite;
        }

        @keyframes fall {
            0% {
                top: -10%;
                opacity: 1;
            }
            100% {
                top: 110%;
                opacity: 0;
            }
        }

        .love-message {
            font-size: 18px;
            font-family: 'Times New Roman', serif;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(255, 182, 193, 0.5);
        }

        .emoji {
            font-size: 1.5em;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: 'Times New Roman', serif;
            z-index: 1000;
        }

        /* 🎵 MUSIC CONTROLS STYLES */
        .music-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .music-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .music-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-family: 'Times New Roman', serif;
            backdrop-filter: blur(10px);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .music-info.show {
            opacity: 1;
        }

        /* 🎮 GAME STYLES */
        .runaway-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #ff6b6b, #ff9ff3);
            border: none;
            border-radius: 25px;
            color: black;
            font-weight: bold;
            font-size: 16px;
            font-family: 'Times New Roman', serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            min-width: 140px;
        }

        .runaway-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .game-canvas {
            border: 3px solid #ff6b6b;
            border-radius: 10px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .game-container {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            border: 2px solid #ff6b6b;
            font-family: 'Times New Roman', serif;
        }

        .game-ui {
            color: white;
            margin: 15px 0;
            font-size: 18px;
            font-family: 'Times New Roman', serif;
        }

        .game-controls {
            margin: 15px 0;
            font-size: 14px;
            color: #feca57;
            font-family: 'Times New Roman', serif;
        }
    </style>
</head>
<body>
    <div class="debug" id="debugInfo">Debug: Ready</div>
    
    <div class="hearts" id="hearts"></div>

    <!-- 🎵 BACKGROUND MUSIC - Upload your own song -->
    <audio id="backgroundMusic" loop volume="0.4">
        <source src="sminky-birthday-song.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- 🎵 MUSIC CONTROLS -->
    <div class="music-controls">
        <button onclick="toggleMusic()" id="musicButton" class="music-btn" title="Toggle Music">🎵</button>
        <button onclick="changeVolume()" id="volumeButton" class="music-btn" title="Change Volume">🔊</button>
    </div>

    <!-- 🎵 MUSIC INFO -->
    <div class="music-info" id="musicInfo">
        🎵 Background music ready
    </div>
    
    <div class="container">
        <div id="startScreen">
            <h1>💕 For My Sminky Girlfriend 💕</h1>
            <p class="love-message">
                <span class="emoji">🎂</span> Ready for your special birthday surprise? <span class="emoji">🎂</span>
            </p>
            <button class="start-btn" onclick="startSurprise()" id="startButton">
                <span class="emoji">✨</span> Start the Magic <span class="emoji">✨</span>
            </button>
            <p style="font-size: 14px; margin-top: 20px; opacity: 0.8;">
                💡 Tip: Turn your phone to landscape mode for best experience!<br>
                🎵 Your special birthday song will play when you start!
            </p>
        </div>

        <div class="art-container" id="artContainer"></div>
    </div>

    <script>
        // 🎵 MUSIC VARIABLES
        var musicPlaying = false;
        var currentVolume = 0.4;
        var musicEnabled = true;

        // Debug function
        function debug(msg) {
            console.log(msg);
            document.getElementById('debugInfo').textContent = 'Debug: ' + msg;
        }

        debug('Script loaded');

        // 🎵 MUSIC FUNCTIONS
        function toggleMusic() {
            var music = document.getElementById('backgroundMusic');
            var button = document.getElementById('musicButton');
            var info = document.getElementById('musicInfo');
            
            if (musicPlaying) {
                music.pause();
                button.textContent = '🔇';
                musicPlaying = false;
                showMusicInfo('Music paused');
                debug('Music paused');
            } else {
                music.play().then(function() {
                    button.textContent = '🎵';
                    musicPlaying = true;
                    showMusicInfo('Music playing');
                    debug('Music playing');
                }).catch(function(error) {
                    debug('Music play failed: ' + error.message);
                    showMusicInfo('Music blocked by browser');
                });
            }
        }

        function changeVolume() {
            var music = document.getElementById('backgroundMusic');
            var button = document.getElementById('volumeButton');
            
            if (currentVolume === 0.4) {
                currentVolume = 0.7;
                button.textContent = '🔊';
                showMusicInfo('Volume: High');
            } else if (currentVolume === 0.7) {
                currentVolume = 0.1;
                button.textContent = '🔉';
                showMusicInfo('Volume: Low');
            } else {
                currentVolume = 0.4;
                button.textContent = '🔊';
                showMusicInfo('Volume: Medium');
            }
            
            music.volume = currentVolume;
            debug('Volume changed to: ' + currentVolume);
        }

        function showMusicInfo(message) {
            var info = document.getElementById('musicInfo');
            info.textContent = '🎵 ' + message;
            info.classList.add('show');
            
            setTimeout(function() {
                info.classList.remove('show');
            }, 2000);
        }

        // 🎵 MUSIC FILE READY CHECK
        function checkMusicFile() {
            var music = document.getElementById('backgroundMusic');
            
            music.addEventListener('canplaythrough', function() {
                debug('Music file loaded successfully');
                showMusicInfo('Your birthday song is ready! 🎵');
            });
            
            music.addEventListener('error', function() {
                debug('Music file not found or error loading');
                showMusicInfo('Upload your music file as "sminky-birthday-song.mp3"');
            });
        }

        // Create falling hearts
        function createHearts() {
            debug('Creating hearts');
            var heartsContainer = document.getElementById('hearts');
            var heartSymbols = ['💕', '💖', '💗', '💝', '💓', '🌟', '✨', '💫'];
            
            setInterval(function() {
                var heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 5) + 's';
                heartsContainer.appendChild(heart);

                setTimeout(function() {
                    heart.remove();
                }, 8000);
            }, 300);
        }

        // Art content with fixed alignment (keep your existing art content)
        var artContent = '                              💕✨ 💖 💫 🌟 💕 💎 ✨💕\n\n' +
'   ╔═════════════════════════════════════════════════════════════════════════════╗\n' +
'   ║                           FOR MY SMINKY GIRLFRIEND                          ║\n' +
'   ╚═════════════════════════════════════════════════════════════════════════════╝\n\n' +
'                                   🕯️ 🕯️ 🕯️ 🕯️ 🕯️\n' +
'                                ┌─────────────────────┐\n' +
'                                │   HAPPY BIRTHDAY    │\n' +
'                                └─────────────────────┘\n' +
'                                🎈 🎈 🎈 🎈 🎈 🎈 🎈\n\n' +
' ██╗  ██╗ █████╗ ██████╗ ██████╗ ██╗   ██╗    ██████╗ ██╗██████╗ ████████╗██╗  ██╗██████╗  █████╗ ██╗   ██╗\n' +
' ██║  ██║██╔══██╗██╔══██╗██╔══██╗╚██╗ ██╔╝    ██╔══██╗██║██╔══██╗╚══██╔══╝██║  ██║██╔══██╗██╔══██╗╚██╗ ██╔╝\n' +
' ███████║███████║██████╔╝██████╔╝ ╚████╔╝     ██████╔╝██║██████╔╝   ██║   ███████║██║  ██║███████║ ╚████╔╝ \n' +
' ██╔══██║██╔══██║██╔═══╝ ██╔═══╝   ╚██╔╝      ██╔══██╗██║██╔══██╗   ██║   ██╔══██║██║  ██║██╔══██║  ╚██╔╝  \n' +
' ██║  ██║██║  ██║██║     ██║        ██║       ██████╔╝██║██║  ██║   ██║   ██║  ██║██████╔╝██║  ██║   ██║   \n' +
' ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝     ╚═╝        ╚═╝       ╚═════╝ ╚═╝╚═╝  ╚═╝   ╚═╝   ╚═╝  ╚═╝╚═════╝ ╚═╝  ╚═╝   ╚═╝   \n\n' +
' ███╗   ███╗██╗   ██╗    ███████╗███╗   ███╗██╗███╗   ██╗██╗  ██╗██╗   ██╗\n' +
' ████╗ ████║╚██╗ ██╔╝    ██╔════╝████╗ ████║██║████╗  ██║██║ ██╔╝╚██╗ ██╔╝\n' +
' ██╔████╔██║ ╚████╔╝     ███████╗██╔████╔██║██║██╔██╗ ██║█████╔╝  ╚████╔╝ \n' +
' ██║╚██╔╝██║  ╚██╔╝      ╚════██║██║╚██╔╝██║██║██║╚██╗██║██╔═██╗   ╚██╔╝  \n' +
' ██║ ╚═╝ ██║   ██║       ███████║██║ ╚═╝ ██║██║██║ ╚████║██║  ██╗   ██║   \n' +
' ╚═╝     ╚═╝   ╚═╝       ╚══════╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝   ╚═╝   \n\n' +
'  ██████╗ ██╗██████╗ ██╗     ███████╗██████╗ ██╗███████╗███╗   ██╗██████╗ \n' +
' ██╔════╝ ██║██╔══██╗██║     ██╔════╝██╔══██╗██║██╔════╝████╗  ██║██╔══██╗\n' +
' ██║  ███╗██║██████╔╝██║     █████╗  ██████╔╝██║█████╗  ██╔██╗ ██║██║  ██║\n' +
' ██║   ██║██║██╔══██╗██║     ██╔══╝  ██╔══██╗██║██╔══╝  ██║╚██╗██║██║  ██║\n' +
' ╚██████╔╝██║██║  ██║███████╗██║     ██║  ██║██║███████╗██║ ╚████║██████╔╝\n' +
'  ╚═════╝ ╚═╝╚═╝  ╚═╝╚══════╝╚═╝     ╚═╝  ╚═╝╚═╝╚══════╝╚═╝  ╚═══╝╚═════╝ \n\n' +
'                       💕 ✨ TO MY SPECIAL SOMEONE ✨ 💕\n\n' +
'                      ╔═══════════════════════════════════╗\n' +
'                      ║  💖 You mean the world to me ~💖  ‎ ║\n' +
'                      ║ 🌟 Every day with you is magic ~🌟‎ ║\n' +
'                      ║💫 You make my heart skip beats ~💫‎ ║\n' +
'                      ║ ✨ My beautiful, sweet sminky ~✨ ‎ ║\n' +          
'                      ╚═══════════════════════════════════╝\n\n' +
'                              🌹 🌹 🌹 🌹 🌹 🌹 🌹\n\n' +
'          💝                                                                💝\n' +
'            💕    ┌─────────────────────────────────────────────────┐    💕\n' +
'              💖  │   "Happy Birthday to the most amazing girl      │  💖\n' +
'              💖  │    who lights up my world every single day!"    │  💖  \n' +
'            💕    └─────────────────────────────────────────────────┘    💕\n' +
'          💝                                                                💝\n\n' +
'                                  🎂 🍰 🧁 🍰 🎂\n\n' +       
'                           ❤️❤️❤️                   ❤️❤️❤️\n' +     
'                         ❤️       ❤️              ❤️       ❤️\n' +
'                       ❤️           ❤️          ❤️            ❤️\n' +
'                     ❤️                ❤️     ❤️                ❤️\n' +
'                    ❤️                   💝💖💝                  ❤️\n' +
'                     ❤️              💖  SMINKY 💖              ❤️\n' +
'                       ❤️           💝    LOVE   💝           ❤️\n' +
'                         ❤️           💖FOREVER💖           ❤️\n' +
'                           ❤️           💝💖💝           ❤️\n' +
'                             ❤️                          ❤️\n' +
'                               ❤️                      ❤️\n' +
'                                 ❤️                  ❤️\n' +
'                                   ❤️              ❤️\n' +
'                                     ❤️          ❤️\n' +
'                                       ❤️      ❤️\n' +
'                                         ❤️  ❤️\n' +
'                                           ❤️\n\n' +
'                          🎊 🎉 🎁 🍾 🥳 🎈 🎂 🕯️ 💐 💕 🌹 ✨\n\n' +
'                           ┌─ "You are not just my girlfriend, ─┐\n' +
'                           │   you are my best friend, my love, │\n' +
'                           │   my everything. Happy Birthday    │\n' +
'                           │   my sweet, adorable sminky!       │\n' +
'                           └────────────────────────────────────┘\n\n' +
'                                 🎵 I LOVE YOU SO MUCH! 🎵\n\n' +
'                               (💝) (💖) (💕) (💗) (💓) (💝)\n' +
'               💕 🌟 💖 💫 ✨ 💎 🌹 💕 🌟 💖 💫 ✨ 💎 🌹 💕 🌟 💖 💫 ✨ 💎 🌹';

        var currentIndex = 0;
        var typingSpeed = 15;
        var finalMessageShown = false; // Prevent duplicate final message

        function typeWriter() {
            debug('Typing: ' + currentIndex + '/' + artContent.length);
            var artContainer = document.getElementById('artContainer');
            
            if (currentIndex < artContent.length) {
                artContainer.textContent = artContent.substring(0, currentIndex + 1);
                currentIndex++;
                setTimeout(typeWriter, typingSpeed);
            } else {
                debug('Typing complete');
                if (!finalMessageShown) {
                    showFinalMessage();
                }
            }
        }

        function showFinalMessage() {
            if (finalMessageShown) {
                debug('Final message already shown, skipping');
                return;
            }
            
            finalMessageShown = true;
            debug('Showing final message');
            
            setTimeout(function() {
                var finalMessage = document.createElement('div');
                finalMessage.className = 'love-message';
                finalMessage.style.animation = 'pulse 2s infinite';
                finalMessage.innerHTML = '<h2 style="color: black; font-weight: bold;">💕 Happy Birthday, Beautiful! 💕</h2>' +
                    '<p style="color: black; font-weight: bold;">Thank you for being the most amazing girlfriend in the world!</p>' +
                    '<p style="color: black; font-weight: bold;">I love you more than words can express! 💖</p>' +
                    '<div style="margin-top: 15px;">' +
                    '<span class="emoji">🎂</span>' +
                    '<span class="emoji">💝</span>' +
                    '<span class="emoji">🌹</span>' +
                    '<span class="emoji">💕</span>' +
                    '</div>';
                document.querySelector('.container').appendChild(finalMessage);
                
                // Add game invitation after final message
                setTimeout(function() {
                    showGameInvitation();
                }, 3000);
            }, 2000);
        }

        // 🎮 GAME INVITATION & RUNAWAY BUTTONS
        function showGameInvitation() {
            var gameInvitation = document.createElement('div');
            gameInvitation.className = 'game-invitation';
            gameInvitation.innerHTML = `
                <div style="text-align: center; margin-top: 30px; padding: 25px; background: rgba(255, 255, 255, 0.1); border-radius: 20px; border: 2px solid rgba(255, 182, 193, 0.5);">
                    <h3 style="color: black; font-weight: bold;">🎮 Surprise Game cho Sminky! 🎮</h3>
                    <p style="color: black; font-weight: bold; margin-bottom: 25px;">Sẵn sàng chơi một game nhỏ để lấy trái tim cuối cùng? 💖</p>
                    <div id="runawayButtons" style="display: flex; gap: 20px; justify-content: center;">
                        <button id="sleepyBtn" class="runaway-btn" onmouseover="runAway(this)" onclick="catchButton(this, 'sleepy')" style="color: black; font-weight: bold;">
                            😴 Đang buồn ngủ
                        </button>
                        <button id="lazyBtn" class="runaway-btn" onmouseover="runAway(this)" onclick="catchButton(this, 'lazy')" style="color: black; font-weight: bold;">  
                            😑 Đang bùn ẻ
                        </button>
                    </div>
                    <p id="gameHint" style="margin-top: 15px; font-size: 14px; opacity: 0.8; color: #feca57;">
                        💡 Hint: Di chuột vào button và chase theo nó! Click 2 lần để bắt được! 🏃‍♀️
                    </p>
                </div>
            `;
            document.querySelector('.container').appendChild(gameInvitation);
        }

        var buttonClickCounts = { sleepy: 0, lazy: 0 };
        var buttonRunawayCounts = { sleepy: 0, lazy: 0 }; // Track how many times button ran away

        function runAway(button) {
            var buttonType = button.id.replace('Btn', '');
            
            // Only run away 3 times max, then stop
            if (buttonRunawayCounts[buttonType] >= 3) {
                button.style.cursor = 'pointer';
                button.title = 'Ready to catch! Click me!';
                return;
            }
            
            if (buttonClickCounts[buttonType] >= 1) return;
            
            buttonRunawayCounts[buttonType]++;
            
            var container = document.querySelector('.container');
            var containerRect = container.getBoundingClientRect();
            
            // Random position within container
            var newX = Math.random() * (containerRect.width - button.offsetWidth);
            var newY = Math.random() * 200 + 50; // Keep within reasonable bounds
            
            button.style.position = 'absolute';
            button.style.left = newX + 'px';
            button.style.top = newY + 'px';
            button.style.transition = 'all 0.8s ease'; // Slower escape animation
            button.style.transform = 'scale(0.9)';
            
            // Show escape count hint with cute Vietnamese message
            var escapeText = buttonRunawayCounts[buttonType] < 3 
                ? `😏 Đố anh bắt được em đó hihi, bắt được mới được chơi game! (${buttonRunawayCounts[buttonType]}/3)`
                : `😅 Hết chạy rồi! Giờ bắt em đi anh! 💕`;
            
            var hint = document.getElementById('gameHint');
            hint.innerHTML = escapeText;
            hint.style.color = 'black';
            hint.style.fontWeight = 'bold';
            
            setTimeout(function() {
                button.style.transform = 'scale(1)';
                if (buttonRunawayCounts[buttonType] >= 3) {
                    button.style.boxShadow = '0 0 20px #4ecdc4';
                    button.style.animation = 'pulse 1s infinite';
                }
            }, 800); // Match the transition duration
        }

        function catchButton(button, type) {
            buttonClickCounts[type]++;
            
            if (buttonClickCounts[type] === 1) {
                button.textContent = type === 'sleepy' ? '😴 Bắt được rồi!' : '😑 Bắt được rồi!';
                button.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
                button.style.color = 'black';
                button.style.fontWeight = 'bold';
                document.getElementById('gameHint').textContent = '🎉 Tuyệt! Giờ bạn có thể chơi game Arkanoid để lấy trái tim! 💖';
                
                setTimeout(function() {
                    // Only start game if not already created
                    if (!gameContainerCreated) {
                        startArkanoidGame();
                    }
                }, 2000);
            }
        }

        function startSurprise() {
            debug('Start surprise clicked!');
            
            // Reset states for fresh start
            currentIndex = 0;
            finalMessageShown = false;
            
            // 🎵 START YOUR UPLOADED MUSIC
            var music = document.getElementById('backgroundMusic');
            music.play().then(function() {
                musicPlaying = true;
                document.getElementById('musicButton').textContent = '🎵';
                showMusicInfo('Your special song is playing! 🎵');
                debug('Music started successfully');
            }).catch(function(error) {
                debug('Music play failed: ' + error.message);
                showMusicInfo('Music blocked - click 🎵 to play manually');
            });
            
            // Hide start screen
            document.getElementById('startScreen').style.display = 'none';
            
            // Show art container
            document.getElementById('artContainer').style.display = 'block';
            
            // Clear any existing content
            document.getElementById('artContainer').textContent = '';
            
            // Start typing animation
            debug('Starting typewriter');
            setTimeout(typeWriter, 1000);
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            debug('Page loaded');
            createHearts();
            checkMusicFile();
            
            // Prime audio for mobile devices
            document.addEventListener('touchstart', function() {
                var music = document.getElementById('backgroundMusic');
                music.play().then(function() {
                    music.pause();
                    debug('Audio primed for mobile');
                });
            }, { once: true });
            
            // Add click event listener as backup
            document.getElementById('startButton').addEventListener('click', function() {
                debug('Button clicked via event listener');
                startSurprise();
            });

            // Show music status on load
            setTimeout(function() {
                showMusicInfo('Upload "sminky-birthday-song.mp3" for music! 🎵');
            }, 1000);
        });

        // Test function
        function testClick() {
            debug('Test click works!');
            alert('Click detection working!');
        }

        // 🎮 ARKANOID GAME
        var gameContainerCreated = false; // Prevent duplicate containers

        function startArkanoidGame() {
            debug('Starting Arkanoid game');
            
            // Prevent multiple game containers
            if (gameContainerCreated) {
                debug('Game container already exists, skipping creation');
                return;
            }
            
            gameContainerCreated = true;
            
            // Hide everything else
            document.querySelector('.container').style.display = 'none';
            
            // Remove any existing game containers first
            var existingContainers = document.querySelectorAll('.game-container');
            existingContainers.forEach(function(container) {
                container.remove();
            });
            
            // Create game container
            var gameContainer = document.createElement('div');
            gameContainer.className = 'game-container';
            gameContainer.innerHTML = `
                <h2 style="color: #ff6b6b; margin-bottom: 20px;">💖 ARKANOID FOR SMINKY 💖</h2>
                <div id="gameIntro" style="
                    background: rgba(255, 255, 255, 0.1);
                    padding: 30px;
                    border-radius: 20px;
                    border: 2px solid #ff6b6b;
                    margin: 20px 0;
                    font-size: 24px;
                    color: #feca57;
                ">
                    <h3 style="color: #ff6b6b; margin-bottom: 15px;">🎯 Mission Brief</h3>
                    <p style="margin-bottom: 20px;">Sẵn sàng chơi giải cứu trái tim chưa bà =)))</p>
                    <div id="countdown" style="
                        font-size: 48px;
                        font-weight: bold;
                        color: #ff6b6b;
                        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                    ">10</div>
                </div>
                <div class="game-ui" style="display: none;">
                    <span id="gameScore">Score: 0</span> | 
                    <span id="gameHearts">Hearts: ❤️❤️❤️❤️❤️❤️</span> | 
                    <span id="gameObjective">🎯 Break all bricks to get the heart!</span>
                </div>
                <canvas id="gameCanvas" class="game-canvas" width="600" height="400" style="display: none;"></canvas>
                <div class="game-controls" style="display: none;">
                    🖱️ Move mouse to control paddle | 🖱️ Click to launch ball | 💥 Break the protective bricks to reach the heart! 💖
                </div>
                <button onclick="restartGame()" style="
                    display: none;
                    margin-top: 15px; 
                    padding: 10px 20px; 
                    background: #ff6b6b; 
                    color: white; 
                    border: none; 
                    border-radius: 20px; 
                    cursor: pointer;
                " id="restartBtn">
                    🔄 Restart Game
                </button>
            `;
            
            document.body.appendChild(gameContainer);
            
            // Start countdown
            startGameCountdown();
        }

        function startGameCountdown() {
            var countdownElement = document.getElementById('countdown');
            var count = 10; // Increased from 5 to 10 seconds
            
            var countdownInterval = setInterval(function() {
                count--;
                
                if (count > 0) {
                    countdownElement.textContent = count;
                    countdownElement.style.transform = 'scale(1.5)';
                    setTimeout(function() {
                        countdownElement.style.transform = 'scale(1)';
                    }, 200);
                } else {
                    countdownElement.textContent = 'GO! 🚀';
                    countdownElement.style.color = '#4ecdc4';
                    
                    setTimeout(function() {
                        // Hide intro, show game
                        document.getElementById('gameIntro').style.display = 'none';
                        document.querySelector('.game-ui').style.display = 'block';
                        document.getElementById('gameCanvas').style.display = 'block';
                        document.querySelector('.game-controls').style.display = 'block';
                        document.getElementById('restartBtn').style.display = 'inline-block';
                        
                        // Initialize game
                        initArkanoidGame();
                    }, 1000);
                    
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        // Game variables
        var canvas, ctx;
        var paddle = { x: 250, y: 370, width: 100, height: 15, speed: 8 };
        var ball = { x: 300, y: 350, dx: 1.7, dy: -1.7, radius: 8 }; // Much slower speed (reduced by 1/3 from 2.5)
        var bricks = [];
        var score = 0;
        var hearts = 6; // Increased from 3 to 6
        var gameRunning = false;
        var pentagon = { x: 300, y: 80, size: 60 }; // Moved pentagon much higher (was y: 200)

        function initArkanoidGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Create protective bricks around pentagon
            createBricks();
            
            // Reset ball position to start from paddle
            resetBall();
            
            // Start game loop
            gameRunning = true;
            
            // Mouse control
            canvas.addEventListener('mousemove', function(e) {
                var rect = canvas.getBoundingClientRect();
                paddle.x = e.clientX - rect.left - paddle.width / 2;
                
                // Keep paddle in bounds
                if (paddle.x < 0) paddle.x = 0;
                if (paddle.x > canvas.width - paddle.width) paddle.x = canvas.width - paddle.width;
                
                // If ball is attached to paddle (game start), move ball with paddle
                if (ball.y >= paddle.y - ball.radius - 5) {
                    ball.x = paddle.x + paddle.width / 2;
                }
            });
            
            // Click to launch ball
            canvas.addEventListener('click', function() {
                if (ball.y >= paddle.y - ball.radius - 5) {
                    // Launch ball upward with slight random angle
                    ball.dy = -1.7; // Updated to match new slower speed
                    ball.dx = (Math.random() - 0.5) * 2; // Reduced horizontal speed too
                }
            });
            
            gameLoop();
        }

        function createBricks() {
            bricks = [];
            var centerX = canvas.width / 2;
            var centerY = 80; // Much higher position (was 200)
            
            // Create concentric circles of bricks around pentagon with much larger radius
            for (var ring = 0; ring < 3; ring++) {
                var radius = 40 + ring * 20; // Smaller protective radius (was 80 + ring * 30)
                var bricksInRing = 6 + ring * 2; // Fewer bricks per ring (was 8 + ring * 4)
                
                for (var i = 0; i < bricksInRing; i++) {
                    var angle = (i / bricksInRing) * 2 * Math.PI;
                    var x = centerX + Math.cos(angle) * radius - 15; // Adjusted for larger size
                    var y = centerY + Math.sin(angle) * radius - 7.5; // Adjusted for larger size
                    
                    bricks.push({
                        x: x,
                        y: y,
                        width: 30, // Increased from 20 to 30 (1.5x)
                        height: 15, // Increased from 10 to 15 (1.5x)
                        color: ring === 0 ? '#ff6b6b' : ring === 1 ? '#feca57' : '#48dbfb',
                        destroyed: false
                    });
                }
            }
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            var gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#1e3c72');
            gradient.addColorStop(1, '#2a5298');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update ball position only if it's moving
            if (ball.dx !== 0 || ball.dy !== 0) {
                ball.x += ball.dx;
                ball.y += ball.dy;
            }
            
            // Ball collision with walls
            if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) {
                ball.dx = -ball.dx;
            }
            if (ball.y < ball.radius) {
                ball.dy = -ball.dy;
            }
            
            // Ball collision with bottom (lose heart)
            if (ball.y > canvas.height) {
                hearts--;
                resetBall();
                updateUI();
                
                if (hearts <= 0) {
                    gameOver();
                    return;
                }
            }
            
            // Ball collision with paddle (improved)
            if (ball.dy > 0 && // Ball moving down
                ball.y + ball.radius >= paddle.y && 
                ball.y - ball.radius <= paddle.y + paddle.height &&
                ball.x >= paddle.x && 
                ball.x <= paddle.x + paddle.width) {
                
                ball.dy = -Math.abs(ball.dy); // Always bounce up
                
                // Add some angle based on where it hits the paddle
                var hitPos = (ball.x - paddle.x) / paddle.width; // 0 to 1
                var maxAngle = 2; // Reduced maximum horizontal speed
                ball.dx = (hitPos - 0.5) * maxAngle * 2; // -2 to +2 (was -3 to +3)
                
                // Ensure minimum upward velocity
                if (Math.abs(ball.dy) < 1.5) {
                    ball.dy = ball.dy < 0 ? -1.7 : 1.7; // Updated to match new speed
                }
            }
            
            // Ball collision with bricks
            for (var i = 0; i < bricks.length; i++) {
                var brick = bricks[i];
                if (!brick.destroyed &&
                    ball.x + ball.radius > brick.x && 
                    ball.x - ball.radius < brick.x + brick.width &&
                    ball.y + ball.radius > brick.y && 
                    ball.y - ball.radius < brick.y + brick.height) {
                    
                    brick.destroyed = true;
                    ball.dy = -ball.dy;
                    score += 10;
                    updateUI();
                    
                    // Check if all bricks destroyed
                    if (bricks.every(b => b.destroyed)) {
                        gameWin();
                        return;
                    }
                    break;
                }
            }
            
            // Draw game objects
            drawBricks();
            drawPentagon();
            drawHeart();
            drawPaddle();
            drawBall();
            
            // Show launch instruction if ball is attached
            if (ball.dx === 0 && ball.dy === 0) {
                ctx.font = '16px "Times New Roman"';
                ctx.fillStyle = '#feca57';
                ctx.textAlign = 'center';
                ctx.fillText('Click to launch! 🚀', canvas.width / 2, canvas.height - 30);
            }
            
            requestAnimationFrame(gameLoop);
        }

        function drawBricks() {
            for (var i = 0; i < bricks.length; i++) {
                var brick = bricks[i];
                if (!brick.destroyed) {
                    ctx.fillStyle = brick.color;
                    ctx.fillRect(brick.x, brick.y, brick.width, brick.height);
                    
                    // Add border
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(brick.x, brick.y, brick.width, brick.height);
                }
            }
        }

        function drawPentagon() {
            var centerX = pentagon.x;
            var centerY = pentagon.y;
            var size = pentagon.size;
            
            ctx.beginPath();
            for (var i = 0; i < 5; i++) {
                var angle = (i * 2 * Math.PI) / 5 - Math.PI / 2;
                var x = centerX + Math.cos(angle) * size;
                var y = centerY + Math.sin(angle) * size;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            // Fill with gradient
            var gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, size);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 107, 107, 0.6)');
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Border
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 3;
            ctx.stroke();
        }

        function drawHeart() {
            var centerX = pentagon.x;
            var centerY = pentagon.y;
            
            ctx.font = '30px "Times New Roman"';
            ctx.fillStyle = '#ff1744';
            ctx.textAlign = 'center';
            ctx.fillText('💖', centerX, centerY + 10);
        }

        function drawPaddle() {
            var gradient = ctx.createLinearGradient(paddle.x, paddle.y, paddle.x + paddle.width, paddle.y);
            gradient.addColorStop(0, '#ff6b6b');
            gradient.addColorStop(1, '#ff9ff3');
            ctx.fillStyle = gradient;
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
        }

        function drawBall() {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = '#feca57';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function resetBall() {
            // Reset ball to paddle position (attached mode)
            ball.x = paddle.x + paddle.width / 2;
            ball.y = paddle.y - ball.radius - 2; // Just above paddle
            ball.dx = 0; // No horizontal movement initially
            ball.dy = 0; // No vertical movement initially
            
            // Show instruction to click
            setTimeout(function() {
                if (ball.dy === 0) { // Ball still attached
                    showTemporaryMessage('Click to launch ball! 🚀');
                }
            }, 1000);
        }

        function showTemporaryMessage(text) {
            var existingMsg = document.getElementById('tempMessage');
            if (existingMsg) existingMsg.remove();
            
            var tempMsg = document.createElement('div');
            tempMsg.id = 'tempMessage';
            tempMsg.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: #feca57;
                padding: 15px 25px;
                border-radius: 20px;
                font-size: 18px;
                font-family: 'Times New Roman', serif;
                z-index: 1000;
                animation: pulse 1s infinite;
            `;
            tempMsg.textContent = text;
            document.querySelector('.game-container').appendChild(tempMsg);
            
            setTimeout(function() {
                if (tempMsg) tempMsg.remove();
            }, 3000);
        }

        function updateUI() {
            document.getElementById('gameScore').textContent = 'Score: ' + score;
            document.getElementById('gameHearts').textContent = 'Hearts: ' + '❤️'.repeat(hearts);
        }

        function gameWin() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = '40px "Times New Roman"';
            ctx.fillStyle = '#ff6b6b';
            ctx.textAlign = 'center';
            ctx.fillText('🎉 YOU WON! 🎉', canvas.width / 2, canvas.height / 2 - 40);
            
            ctx.font = '24px "Times New Roman"';
            ctx.fillStyle = 'white';
            ctx.fillText('You got the heart! 💖', canvas.width / 2, canvas.height / 2);
            ctx.fillText('Sminky is so lucky to have you! 💕', canvas.width / 2, canvas.height / 2 + 40);
            
            setTimeout(function() {
                showFinalGameMessage();
            }, 3000);
        }

        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = '40px "Times New Roman"';
            ctx.fillStyle = '#ff6b6b';
            ctx.textAlign = 'center';
            ctx.fillText('💔 GAME OVER 💔', canvas.width / 2, canvas.height / 2 - 20);
            
            ctx.font = '20px "Times New Roman"';
            ctx.fillStyle = 'white';
            ctx.fillText('Click restart to try again!', canvas.width / 2, canvas.height / 2 + 20);
        }

        function restartGame() {
            score = 0;
            hearts = 6; // Reset to 6 hearts
            createBricks();
            resetBall();
            updateUI();
            
            // Remove any temporary messages
            var tempMsg = document.getElementById('tempMessage');
            if (tempMsg) tempMsg.remove();
            
            // Reset game container flag to allow recreation if needed
            gameContainerCreated = false;
            
            gameRunning = true;
            gameLoop();
        }

        function showFinalGameMessage() {
            document.body.innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    min-height: 100vh;
                    background: #ffc2d1;
                    text-align: center;
                    color: white;
                    font-family: 'Times New Roman', serif;
                ">
                    <h1 style="font-size: 3em; margin-bottom: 30px; color: black;">🎉 CONGRATULATIONS! 🎉</h1>
                    <h2 style="font-size: 2em; margin-bottom: 20px; color: black;">💖 You've collected all the hearts! 💖</h2>
                    <p style="font-size: 1.5em; margin-bottom: 40px; color: black;">
                        Just like in this game, you've broken through all barriers<br>
                        to reach my heart, dear Sminky! 💕
                    </p>
                    <div style="
                        background: rgba(255, 255, 255, 0.1);
                        padding: 30px;
                        border-radius: 20px;
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        max-width: 600px;
                    ">
                        <h3 style="color: black; margin-bottom: 20px;">🌟 Final Birthday Message 🌟</h3>
                        <p style="font-size: 1.2em; line-height: 1.6; color: black;">
                            Happy Birthday, my beautiful Sminky! 🎂<br><br>
                            This entire surprise - the art, the music, the game - 
                            was coded with love just for you! 💻💕<br><br>
                            You make every day feel like a celebration! 🎉<br><br>
                            I love you more than all the code in the world! 👨‍💻❤️👩‍💻
                        </p>
                    </div>
                    <div style="margin-top: 30px; font-size: 2em;">
                        💕 ✨ 🎂 🎮 💖 🌟 💕
                    </div>
                    <div style="margin-top: 30px;">
                        <button onclick="shareExperience()" style="
                            padding: 15px 30px;
                            background: linear-gradient(45deg, #ff6b6b, #ff9ff3);
                            border: none;
                            border-radius: 50px;
                            color: white;
                            font-size: 18px;
                            font-family: 'Times New Roman', serif;
                            cursor: pointer;
                            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                            transition: all 0.3s ease;
                            margin: 10px;
                        ">
                            📷 Share This Memory
                        </button>
                        <button onclick="downloadPage()" style="
                            padding: 15px 30px;
                            background: linear-gradient(45deg, #4ecdc4, #44a08d);
                            border: none;
                            border-radius: 50px;
                            color: white;
                            font-size: 18px;
                            font-family: 'Times New Roman', serif;
                            cursor: pointer;
                            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                            transition: all 0.3s ease;
                            margin: 10px;
                        ">
                            💾 Save Memory
                        </button>
                    </div>
                </div>
            `;
            
            // Add share functions
            window.shareExperience = function() {
                if (navigator.share) {
                    navigator.share({
                        title: '💕 Birthday Surprise for Sminky',
                        text: 'Someone made an amazing interactive birthday surprise! 🎂✨',
                        url: window.location.href
                    }).catch(console.error);
                } else {
                    // Fallback: copy URL to clipboard
                    navigator.clipboard.writeText(window.location.href).then(function() {
                        alert('🔗 Link copied! Share this special moment! 💕');
                    });
                }
            };
            
            window.downloadPage = function() {
                // Create a downloadable version of the memory
                var blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'sminky-birthday-surprise.html';
                a.click();
                URL.revokeObjectURL(url);
                
                // Show confirmation
                setTimeout(function() {
                    alert('💾 Birthday memory saved! Keep this forever! 💕');
                }, 500);
            };
        }
    </script>
</body>
</html>
